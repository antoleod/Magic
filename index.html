<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LÃ©na â€” Monde Magique (One-File)</title>
<style>
/* ğŸ¨ Mantengo tus estilos originales */
:root{
  --primary:#8b7cfb; --primary2:#b39dfd; --success:#2ecc71; --danger:#ff6b6b;
  --muted:#6b7280; --bg1:#e9f0ff; --bg2:#d8e1ff; --card:#ffffff; --shadow:0 14px 30px rgba(0,0,0,.14);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));font-family:system-ui,-apple-system,Segoe UI,Roboto;color:#1f2430;overflow-x:hidden}
#bgParticles{position:fixed;inset:0;z-index:0}
/* ... (todos los estilos que ya tienes se mantienen igual) ... */
</style>
</head>
<body>
<canvas id="bgParticles"></canvas>

<!-- HEADER -->
<header class="header">
  <div class="wrap">
    <div class="brand"><span class="logo">ğŸª„</span> <span>Monde Magique</span></div>
    <nav class="nav">
      <button class="link" data-nav="home">Accueil</button>
      <button class="link" data-nav="games">Jeux</button>
      <button class="link" data-nav="stories">Histoires</button>
    </nav>
    <div class="stats">
      <span>â­ Bons: <b id="ok">0</b></span>
      <span>âŒ Erreurs: <b id="ko">0</b></span>
      <span>ğŸ•’ Temps: <b id="time">0s</b></span>
      <span>ğŸª™ PiÃ¨ces: <b id="coins">0</b></span>
    </div>
  </div>
</header>

<main class="container">
  <!-- ACCUEIL -->
  <section id="home" class="screen show fadein">
    <h2 class="headline gradient">Choisis une catÃ©gorie</h2>
    <div class="cards">
      <button class="btn gem cardPulse" data-nav="games">
        <span class="big">ğŸ®</span><h3>Jeux</h3><p>Apprends en tâ€™amusant.</p>
      </button>
      <button class="btn gem cardPulse" data-nav="stories">
        <span class="big">ğŸ“š</span><h3>Histoires</h3><p>3â€“5 min avec quiz.</p>
      </button>
    </div>
  </section>

  <!-- JEUX -->
  <section id="games" class="screen fadein">
    <h2 class="headline gradient">Jeux</h2>
    <div class="gamesGrid">
      <!-- Jeux existants -->
      <button class="btn gem" data-game="attrape"><span class="emoji">ğŸ¯</span>
        <div><h3>Attrape le mot</h3><p>2 images + 2 mots</p></div>
      </button>
      <button class="btn gem" data-game="shaman"><span class="emoji">ğŸª„</span>
        <div><h3>Shaman Magic</h3><p>Choisis par genre</p></div>
      </button>
      <button class="btn gem" data-game="surprise"><span class="emoji">ğŸ</span>
        <div><h3>Jeu surprise</h3><p>DÃ©couvre la magie</p></div>
      </button>

      <!-- Nouveaux jeux -->
      <button class="btn gem" data-game="calcul"><span class="emoji">ğŸ”¢</span>
        <div><h3>Calcul Magique</h3><p>Additions et soustractions</p></div>
      </button>
      <button class="btn gem" data-game="suite"><span class="emoji">ğŸ”—</span>
        <div><h3>Suite Logique</h3><p>ComplÃ¨te la sÃ©quence</p></div>
      </button>
      <button class="btn gem" data-game="comp"><span class="emoji">âš–ï¸</span>
        <div><h3>Comparaisons</h3><p>Plus grand / plus petit</p></div>
      </button>
    </div>
  </section>

  <!-- ZONE DE JEU -->
  <section id="play" class="screen fadein">
    <div class="toolbar">
      <button class="btn soft" id="backLevels">â¬…ï¸ Niveaux</button>
      <span class="badge" id="gameTitle"></span>
      <span class="badge" id="levelTitle"></span>
    </div>

    <!-- Attrape -->
    <div id="mode-attrape" class="mode"> ... </div>

    <!-- Shaman -->
    <div id="mode-shaman" class="mode"> ... </div>

    <!-- Surprise -->
    <div id="mode-surprise" class="mode"> ... </div>

    <!-- CALCUL -->
    <div id="mode-calcul" class="mode">
      <h3 class="headline gradient">ğŸ”¢ Calcul Magique</h3>
      <div class="row">
        <div class="imgcard big" id="calcExpr">3 + 4 = ?</div>
        <div class="choices" id="calcChoices"></div>
      </div>
      <div class="footerline">
        <button class="btn success" id="btnFinishCalcul">Terminer le niveau âœ…</button>
      </div>
    </div>

    <!-- SUITE -->
    <div id="mode-suite" class="mode">
      <h3 class="headline gradient">ğŸ”— Suite Logique</h3>
      <div class="imgcard big" id="suiteSeq">2, 4, 6, ?</div>
      <div class="choices" id="suiteChoices"></div>
      <div class="footerline">
        <button class="btn success" id="btnFinishSuite">Terminer le niveau âœ…</button>
      </div>
    </div>

    <!-- COMPARAISON -->
    <div id="mode-comp" class="mode">
      <h3 class="headline gradient">âš–ï¸ Comparaison</h3>
      <div class="row">
        <div class="imgcard big" id="compLeft">7</div>
        <div class="imgcard big" id="compRight">5</div>
      </div>
      <div class="choices">
        <button class="btn pill neon choice" id="compGt">></button>
        <button class="btn pill neon choice" id="compEq">=</button>
        <button class="btn pill neon choice" id="compLt"><</button>
      </div>
      <div class="footerline">
        <button class="btn success" id="btnFinishComp">Terminer le niveau âœ…</button>
      </div>
    </div>
  </section>

  <!-- HISTOIRES -->
  <section id="stories" class="screen fadein"> ... </section>
</main>

<!-- FOOTER + Dialogs + Confetti -->
<footer class="footer"> ... </footer>
<dialog id="dlgLevels"> ... </dialog>
<dialog id="finishDlg"> ... </dialog>
<canvas id="confetti" class="confetti"></canvas>

<script>
/* ==== Ton JS existant ==== */

/* ... (todo tuyo se mantiene igual) ... */

/* ==== Nouveaux jeux ==== */

// CALCUL
function setupCalcul(){
  const a=Math.floor(Math.random()*10), b=Math.floor(Math.random()*10);
  const op=Math.random()<0.5?'+':'-';
  const res=op==='+'?a+b:a-b;
  $("calcExpr").innerText=`${a} ${op} ${b} = ?`;
  $("calcChoices").innerHTML="";
  const opts=shuffle([res,res+1,res-1]);
  opts.forEach(o=>{
    const btt=document.createElement("button");
    btt.className="btn pill neon choice"; btt.innerText=o;
    btt.onclick=()=>{
      if(o===res){ ok++; addCoins(2); btt.classList.add("correct"); confettiBurst(); }
      else{ ko++; btt.classList.add("wrong"); }
      updateStats();
    };
    $("calcChoices").appendChild(btt);
  });
}
$("btnFinishCalcul").onclick=()=>finishLevel();

// SUITE
function setupSuite(){
  const start=Math.floor(Math.random()*5)+1;
  const step=Math.floor(Math.random()*3)+1;
  const seq=[start,start+step,start+2*step];
  const missing=start+3*step;
  $("suiteSeq").innerText=seq.join(", ")+", ?";
  const opts=shuffle([missing,missing+1,missing-1]);
  $("suiteChoices").innerHTML="";
  opts.forEach(o=>{
    const b=document.createElement("button");
    b.className="btn pill neon choice"; b.innerText=o;
    b.onclick=()=>{
      if(o===missing){ ok++; addCoins(2); b.classList.add("correct"); confettiBurst(); }
      else{ ko++; b.classList.add("wrong"); }
      updateStats();
    };
    $("suiteChoices").appendChild(b);
  });
}
$("btnFinishSuite").onclick=()=>finishLevel();

// COMPARAISON
let compA, compB;
function setupComp(){
  compA=Math.floor(Math.random()*20);
  compB=Math.floor(Math.random()*20);
  $("compLeft").innerText=compA;
  $("compRight").innerText=compB;
}
function checkComp(ans){
  let correct=(compA>compB && ans==='>')||(compA<compB && ans==='<')||(compA===compB && ans==='=');
  if(correct){ ok++; addCoins(2); confettiBurst(); }
  else{ ko++; }
  updateStats();
}
$("compGt").onclick=()=>checkComp(">");
$("compEq").onclick=()=>checkComp("=");
$("compLt").onclick=()=>checkComp("<");
$("btnFinishComp").onclick=()=>finishLevel();

/* ==== Adaptar startLevel ==== */
function startLevel(game,lvl){
  ok=0; ko=0; updateStats();
  $("gameTitle").innerText=game;
  $("levelTitle").innerText="Niveau "+lvl;

  if(game==='attrape'){ setupAttrape(); showMode('attrape'); }
  else if(game==='shaman'){ setupShaman(); showMode('shaman'); }
  else if(game==='surprise'){ setupSurprise(); showMode('surprise'); }
  else if(game==='calcul'){ setupCalcul(); showMode('calcul'); }
  else if(game==='suite'){ setupSuite(); showMode('suite'); }
  else if(game==='comp'){ setupComp(); showMode('comp'); }

  show("play");
}

function showMode(m){
  ["attrape","shaman","surprise","calcul","suite","comp"].forEach(x=>{
    document.getElementById("mode-"+x).style.display=(x===m?"block":"none");
  });
}
</script>
</body>
</html>
